{% extends 'base.html.twig' %}

{% block title %}{{ 'properties.list.title'|trans }}{% endblock %}

{% block stylesheets %}
<link href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.css" rel="stylesheet">
<style>
    .property-card {
        transition: transform 0.3s ease;
    }
    .property-card:hover {
        transform: translateY(-5px);
    }
    .property-image {
        height: 250px;
        object-fit: cover;
    }
    .property-features {
        font-size: 0.9rem;
    }
</style>
{% endblock %}

{% block body %}
    <div class="container-xxl py-5">
        <div class="container">
            <div class="row g-0 gx-5 align-items-end">
                <div class="col-lg-6">
                    <div class="text-start mx-auto mb-5">
                        <h1 class="mb-3">{{ 'properties.list.heading'|trans }}</h1>
                        <p>{{ 'properties.list.description'|trans }}</p>
                    </div>
                </div>
                <div class="col-lg-6 text-start text-lg-end">
                    <div class="mb-5">
                        {{ form_start(form, {'attr': {'class': 'property-filter-form'}}) }}
                            <div class="row g-3">
                                <div class="col-md-6">
                                    {{ form_row(form.type, {
                                        'attr': {'class': 'form-select'}
                                    }) }}
                                </div>
                                <div class="col-md-6">
                                    {{ form_row(form.location, {
                                        'attr': {'class': 'form-control'}
                                    }) }}
                                </div>
                                <div class="col-md-6">
                                    {{ form_row(form.min_price, {
                                        'attr': {'class': 'form-control'}
                                    }) }}
                                </div>
                                <div class="col-md-6">
                                    {{ form_row(form.max_price, {
                                        'attr': {'class': 'form-control'}
                                    }) }}
                                </div>
                                <div class="col-md-6">
                                    {{ form_row(form.min_area, {
                                        'attr': {'class': 'form-control'}
                                    }) }}
                                </div>
                                <div class="col-md-6">
                                    {{ form_row(form.max_area, {
                                        'attr': {'class': 'form-control'}
                                    }) }}
                                </div>
                                <div class="col-md-6">
                                    {{ form_row(form.sort, {
                                        'attr': {'class': 'form-select'}
                                    }) }}
                                </div>
                                <div class="col-md-6">
                                    <button type="submit" class="btn btn-primary w-100">
                                        <i class="bi bi-search me-2"></i>{{ 'properties.filter.search'|trans }}
                                    </button>
                                </div>
                            </div>
                        {{ form_end(form) }}
                    </div>
                </div>
            </div>

            <div class="tab-content">
                <div id="tab-1" class="tab-pane fade show p-0 active">
                    <div class="row g-4" id="properties-list">
                        {% for property in properties %}
                            <div class="col-lg-4 col-md-6">
                                {% include 'property/_card.html.twig' with {'property': property} %}
                            </div>
                        {% else %}
                            <div class="col-12 text-center py-5">
                                <h3>{{ 'properties.list.no_results'|trans }}</h3>
                                <p>{{ 'properties.list.try_different_filters'|trans }}</p>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <div class="row mt-5">
                <div class="col-12">
                    <div class="pagination justify-content-center">
                        {{ knp_pagination_render(properties) }}
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.querySelector('.property-filter-form');
            const propertiesList = document.getElementById('properties-list');

            form.addEventListener('change', function() {
                const formData = new FormData(form);
                const params = new URLSearchParams(formData);

                fetch('{{ path('app_property_search') }}?' + params.toString(), {
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                })
                .then(response => response.text())
                .then(html => {
                    propertiesList.innerHTML = html;
                    history.pushState({}, '', '{{ path('app_property_index') }}?' + params.toString());
                });
            });
        });
    </script>
{% endblock %} 